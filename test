-- Wrap peripherals
local colony_integrator = peripheral.wrap("top")  -- integrator on top
local me_bridge        = peripheral.wrap("bottom") -- ME Bridge on bottom
local chest            = peripheral.wrap("back")   -- chest on back

if not colony_integrator then error("No Colony Integrator found on top!") end
if not me_bridge then error("No ME Bridge found on bottom!") end
if not chest then error("No chest found on back!") end

-- Helper function: export items from ME Bridge to chest
local function exportItemToChest(itemName, count)
    local stack = { name = itemName, count = count }
    local sides = {"top","bottom","left","right","front","back"} -- just in case

    -- Attempt export to chest
    local exported = 0
    for _, side in ipairs(sides) do
        local ok, result = pcall(function()
            return me_bridge.exportItem(stack, side)
        end)
        if ok and result > 0 then
            exported = exported + result
        end
    end

    if exported > 0 then
        print("Exported " .. exported .. "x " .. itemName .. " to chest.")
    else
        print("Failed to export " .. itemName)
    end

    return exported
end

-- Example: scan requests from integrator and export
local requests = colony_integrator.getRequests()
for _, req in ipairs(requests) do
    local itemName = req.items[1].name
    local itemCount = req.count
    exportItemToChest(itemName, itemCount)
end
