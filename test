local colony = peripheral.wrap("top")
local me = peripheral.wrap("bottom")

-- Computer position
local compX, compY, compZ = 31, 62, -45

-- Logging helper
local function log(msg)
    local timestamp = os.date("%H:%M:%S")
    print(timestamp .. " | " .. msg)
    local file = fs.open("automation_log.txt", "a")
    file.writeLine(timestamp .. " | " .. msg)
    file.close()
end

-- Find nearest builder hut
local function getNearestBuilder()
    local nearest = nil
    local nearestDist = math.huge
    local buildings = colony.getBuildings() or {}
    for _, b in ipairs(buildings) do
        if b.type == "builder" then
            local x, y, z = b.location.x, b.location.y, b.location.z
            local dist = math.sqrt((x - compX)^2 + (y - compY)^2 + (z - compZ)^2)
            if dist < nearestDist then
                nearestDist = dist
                nearest = b
            end
        end
    end
    return nearest
end

-- Fulfill requests for nearest builder hut
local function fulfillNearestBuilderRequests()
    local nearest = getNearestBuilder()
    if not nearest then
        log("No builder huts found")
        return
    end

    log("Targeting nearest builder hut: " .. nearest.name)
    local requests = colony.getRequests() or {}
    for _, req in ipairs(requests) do
        if req.target == nearest.name then
            -- Here youâ€™d call your fulfillRequest(req) function
            log("Processing request for " .. req.target)
        end
    end
end

-- Main loop
while true do
    fulfillNearestBuilderRequests()
    sleep(1)
end
