--------------------
-- MAIN LOOP (continuous export)
--------------------
local SHORT_SLEEP = 0.1 -- seconds between partial exports

while true do
    local requests = colony_integrator.getRequests()
    for _, req in ipairs(requests) do
        if req.target == "Builder Ezra P. Barrett" then
            local itemName = req.items[1].name
            local remaining = req.count
            dprint("Processing request:", itemName, "x" .. remaining)

            while remaining > 0 do
                local exported = exportItem(itemName, remaining)
                if exported == 0 then
                    -- Nothing could be exported this tick, wait a bit
                    sleep(SHORT_SLEEP)
                else
                    remaining = remaining - exported
                end
            end
        end
    end
    sleep(SCAN_INTERVAL)
end
