-- Wrap source and destination
local source = peripheral.wrap("top")       -- barrel or chest with items
local destination = peripheral.wrap("back") -- the chest you want to move items into

if not source then error("Source inventory not found!") end
if not destination then error("Destination chest not found!") end

-- Function to get items safely
local function getAllItems(inv)
    if type(inv.list) == "function" then
        return inv.list() -- some mod inventories
    elseif type(inv.getAllStacks) == "function" then
        return inv.getAllStacks() -- barrels, storage drawers, etc
    else
        error("Inventory has no supported list method")
    end
end

local items = getAllItems(source)

for slot, stack in pairs(items) do
    local countMoved
    if type(destination.pullItem) == "function" then
        countMoved = destination.pullItem(peripheral.getName(source), slot, stack.count)
    elseif type(destination.pushItem) == "function" then
        countMoved = destination.pushItem(peripheral.getName(source), slot, stack.count)
    else
        error("Destination has no pushItem or pullItem method")
    end
    print("Attempted to move " .. stack.count .. " x " .. stack.name .. " -> Moved: " .. (countMoved or 0))
end
