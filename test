-- AE2 Colony Warehouse Export for Ezra's Builder Hut
-- Only exports items requested by Ezra's Builder Hut
-- Pushes items to ME Bridge output side (back) or a connected barrel

local meBridge = peripheral.find("meBridge")
local colony  = peripheral.find("colonyIntegrator")
if not meBridge then error("No ME Bridge found!") end
if not colony then error("No Colony Integrator found!") end

local OUTPUT_SIDE = "back"  -- Adjust to your barrel/ME Chest side

local function exportToBuilderHut()
    local requests = colony.getRequests() or {}
    for _, req in ipairs(requests) do
        -- Only handle Ezra's Builder Hut requests
        if req.target:match("Builder") then
            local itemName  = req.items[1].name
            local itemCount = req.count
            local stack     = { name = itemName, count = itemCount }

            local ok, exported = pcall(meBridge.exportItem, meBridge, stack, OUTPUT_SIDE)
            if ok and type(exported) == "number" and exported > 0 then
                print(string.format("Exported %d x %s to Ezra's Builder Hut via %s", exported, itemName, OUTPUT_SIDE))
            else
                print(string.format("Failed to export %s to Ezra's Builder Hut via %s", itemName, OUTPUT_SIDE))
            end
        end
    end
end

-- Main loop: scan and export every 10 seconds
while true do
    exportToBuilderHut()
    sleep(10)
end
