-- Wrap the ME Chest
local meChest = peripheral.wrap("bottom")  -- Your ME Chest
local targetSide = "back"                  -- Side of connected chest or Builder Hut

if not meChest then error("ME Chest not found on bottom") end
if not peripheral.isPresent(targetSide) then error("No inventory found on side " .. targetSide) end

-- Push items from ME Chest to target inventory
local function pushItemFromME(itemName, count)
    local remaining = count
    while remaining > 0 do
        local stack = { name = itemName, count = remaining }

        -- pushItem exists on inventories like ME Chest, Ender Chest, etc.
        local ok, pushed = pcall(meChest.pushItem, meChest, targetSide, stack)
        if ok and pushed and pushed > 0 then
            print("Pushed " .. pushed .. "x " .. itemName .. " to " .. targetSide)
            remaining = remaining - pushed
        else
            print("Failed to push " .. itemName .. ", retrying...")
            sleep(1)
        end
    end
end

-- Example: loop through Builder Hut requests
local colony = peripheral.wrap("top")  -- Colony Integrator
local requests = colony.getRequests() or {}

for _, req in ipairs(requests) do
    if req.target:find("Builder") and req.items and #req.items > 0 then
        local item = req.items[1].name
        local count = req.count or 1
        print("Sending " .. count .. "x " .. item .. " to Builder Hut")
        pushItemFromME(item, count)
    end
end
