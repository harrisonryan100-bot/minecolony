while true do
    local requests = colony_integrator.getRequests() or {}

    for _, req in ipairs(requests) do
        if req.target == "Builder Ezra P. Barrett" and req.items then
            for _, item in ipairs(req.items) do
                local itemName = item.name
                local needed = item.count or 0
                local aeItems = me_bridge.listItems() or {}
                local available = 0
                for _, data in ipairs(aeItems) do
                    if data.name == itemName then
                        available = data.count or 0
                        break
                    end
                end
                local toExport = math.min(available, needed)
                if toExport > 0 then
                    local exported = me_bridge.exportItem({name=itemName, count=toExport}, "left")
                    print("Exported", exported, itemName)
                else
                    print("Not enough", itemName, "in storage")
                end
                sleep(0.5)  -- short pause between items
            end
        end
    end

    sleep(10)  -- pause before next cycle
end
