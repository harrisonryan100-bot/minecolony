-- ===========================================
-- MineColonies <-> AE2 Builder Automation Script
-- Colony Integrator on TOP, ME Bridge on BOTTOM
-- Processes Builder Hut requests (PENDING or IN_PROGRESS)
-- Parses quantity prefixes in request.name into AE2 item IDs
-- Logs activity to automation_log.txt
-- ===========================================

-- Wrap peripherals
colony = peripheral.wrap("top")      -- Colony Integrator
me = peripheral.wrap("bottom")       -- ME Bridge

if not colony then
    print("Colony Integrator NOT detected on top! Exiting.")
    return
else
    print("Colony Integrator detected on top")
end

if not me then
    print("ME Bridge NOT detected on bottom! Exiting.")
    return
else
    print("ME Bridge detected on bottom")
end

-- Clear previous log
if fs.exists("automation_log.txt") then
    fs.delete("automation_log.txt")
end

-- Logging helper
function log(msg)
    local timestamped = os.date("%H:%M:%S") .. " | " .. msg
    print(timestamped)
    local file = fs.open("automation_log.txt", "a")
    file.writeLine(timestamped)
    file.close()
end

-- Mapping from parsed request names to AE2 item IDs
-- Add more entries for all items your Builder Hut can request
nameToAE2 = {
    ["Crafting Table"] = "minecraft:crafting_table",
    ["Polished Deepslate Panel"] = "minecraft:polished_deepslate_slab",
    ["Spruce Fence"] = "minecraft:spruce_fence",
    ["Oak Planks"] = "minecraft:oak_planks",
    ["Stone Bricks"] = "minecraft:stone_bricks",
    ["Polished Deepslate Slab"] = "minecraft:polished_deepslate_slab",
    ["Cobblestone Extra Shingles"] = "minecraft:cobblestone" -- example, map to actual AE2 ID
}

-- Count items in AE2 network
function getItemCount(meBridge, itemName)
    local items = meBridge.getItems() or {}
    local total = 0
    for _, item in pairs(items) do
        if
